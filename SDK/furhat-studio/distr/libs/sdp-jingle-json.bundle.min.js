!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.SJJ=e():"undefined"!=typeof global?global.SJJ=e():"undefined"!=typeof self&&(self.SJJ=e())}(function(){return function e(n,o,f){function d(t,u){if(!o[t]){if(!n[t]){var l="function"==typeof require&&require;if(!u&&l)return l(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var p=o[t]={exports:{}};n[t][0].call(p.exports,function(e){var o=n[t][1][e];return d(o?o:e)},p,p.exports,e,n,o,f)}return o[t].exports}for(var i="function"==typeof require&&require,t=0;t<f.length;t++)d(f[t]);return d}({1:[function(e,n,o){var f=e("./lib/tosdp"),d=e("./lib/tojson");o.toIncomingSDPOffer=function(e){return f.toSessionSDP(e,{role:"responder",direction:"incoming"})},o.toOutgoingSDPOffer=function(e){return f.toSessionSDP(e,{role:"initiator",direction:"outgoing"})},o.toIncomingSDPAnswer=function(e){return f.toSessionSDP(e,{role:"initiator",direction:"incoming"})},o.toOutgoingSDPAnswer=function(e){return f.toSessionSDP(e,{role:"responder",direction:"outgoing"})},o.toIncomingMediaSDPOffer=function(e){return f.toMediaSDP(e,{role:"responder",direction:"incoming"})},o.toOutgoingMediaSDPOffer=function(e){return f.toMediaSDP(e,{role:"initiator",direction:"outgoing"})},o.toIncomingMediaSDPAnswer=function(e){return f.toMediaSDP(e,{role:"initiator",direction:"incoming"})},o.toOutgoingMediaSDPAnswer=function(e){return f.toMediaSDP(e,{role:"responder",direction:"outgoing"})},o.toCandidateSDP=f.toCandidateSDP,o.toMediaSDP=f.toMediaSDP,o.toSessionSDP=f.toSessionSDP,o.toIncomingJSONOffer=function(e,n){return d.toSessionJSON(e,{role:"responder",direction:"incoming",creators:n})},o.toOutgoingJSONOffer=function(e,n){return d.toSessionJSON(e,{role:"initiator",direction:"outgoing",creators:n})},o.toIncomingJSONAnswer=function(e,n){return d.toSessionJSON(e,{role:"initiator",direction:"incoming",creators:n})},o.toOutgoingJSONAnswer=function(e,n){return d.toSessionJSON(e,{role:"responder",direction:"outgoing",creators:n})},o.toIncomingMediaJSONOffer=function(e,n){return d.toMediaJSON(e,{role:"responder",direction:"incoming",creator:n})},o.toOutgoingMediaJSONOffer=function(e,n){return d.toMediaJSON(e,{role:"initiator",direction:"outgoing",creator:n})},o.toIncomingMediaJSONAnswer=function(e,n){return d.toMediaJSON(e,{role:"initiator",direction:"incoming",creator:n})},o.toOutgoingMediaJSONAnswer=function(e,n){return d.toMediaJSON(e,{role:"responder",direction:"outgoing",creator:n})},o.toCandidateJSON=d.toCandidateJSON,o.toMediaJSON=d.toMediaJSON,o.toSessionJSON=d.toSessionJSON},{"./lib/tojson":4,"./lib/tosdp":5}],2:[function(e,n,o){o.lines=function(e){return e.split("\r\n").filter(function(e){return e.length>0})},o.findLine=function(e,n,o){for(var f=e.length,d=0;d<n.length;d++)if(n[d].substr(0,f)===e)return n[d];if(!o)return!1;for(var i=0;i<o.length;i++)if(o[i].substr(0,f)===e)return o[i];return!1},o.findLines=function(e,n,o){for(var f=[],d=e.length,i=0;i<n.length;i++)n[i].substr(0,d)===e&&f.push(n[i]);if(f.length||!o)return f;for(var t=0;t<o.length;t++)o[t].substr(0,d)===e&&f.push(o[t]);return f},o.mline=function(e){for(var n=e.substr(2).split(" "),o={media:n[0],port:n[1],proto:n[2],formats:[]},f=3;f<n.length;f++)n[f]&&o.formats.push(n[f]);return o},o.rtpmap=function(e){var n=e.substr(9).split(" "),o={id:n.shift()};return n=n[0].split("/"),o.name=n[0],o.clockrate=n[1],o.channels=3==n.length?n[2]:"1",o},o.sctpmap=function(e){var n=e.substr(10).split(" "),o={number:n.shift(),protocol:n.shift(),streams:n.shift()};return o},o.fmtp=function(e){for(var n,o,f,d=e.substr(e.indexOf(" ")+1).split(";"),i=[],t=0;t<d.length;t++)n=d[t].split("="),o=n[0].trim(),f=n[1],o&&f?i.push({key:o,value:f}):o&&i.push({key:"",value:o});return i},o.crypto=function(e){var n=e.substr(9).split(" "),o={tag:n[0],cipherSuite:n[1],keyParams:n[2],sessionParams:n.slice(3).join(" ")};return o},o.fingerprint=function(e){var n=e.substr(14).split(" ");return{hash:n[0],value:n[1]}},o.extmap=function(e){var n=e.substr(9).split(" "),o={},f=n.shift(),d=f.indexOf("/");return d>=0?(o.id=f.substr(0,d),o.senders=f.substr(d+1)):(o.id=f,o.senders="sendrecv"),o.uri=n.shift()||"",o},o.rtcpfb=function(e){var n=e.substr(10).split(" "),o={};return o.id=n.shift(),o.type=n.shift(),"trr-int"===o.type?o.value=n.shift():o.subtype=n.shift()||"",o.parameters=n,o},o.candidate=function(e){var n;n=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var o={foundation:n[0],component:n[1],protocol:n[2].toLowerCase(),priority:n[3],ip:n[4],port:n[5],type:n[7],generation:"0"},f=8;f<n.length;f+=2)"raddr"===n[f]?o.relAddr=n[f+1]:"rport"===n[f]?o.relPort=n[f+1]:"generation"===n[f]?o.generation=n[f+1]:"tcptype"===n[f]&&(o.tcpType=n[f+1]);return o.network="1",o},o.sourceGroups=function(e){for(var n=[],o=0;o<e.length;o++){var f=e[o].substr(13).split(" ");n.push({semantics:f.shift(),sources:f})}return n},o.sources=function(e){for(var n=[],o={},f=0;f<e.length;f++){var d=e[f].substr(7).split(" "),i=d.shift();if(!o[i]){var t={ssrc:i,parameters:[]};n.push(t),o[i]=t}d=d.join(" ").split(":");var u=d.shift(),l=d.join(":")||null;o[i].parameters.push({key:u,value:l})}return n},o.groups=function(e){for(var n,o=[],f=0;f<e.length;f++)n=e[f].substr(8).split(" "),o.push({semantics:n.shift(),contents:n});return o},o.bandwidth=function(e){var n=e.substr(2).split(":"),o={};return o.type=n.shift(),o.bandwidth=n.shift(),o},o.msid=function(e){var n=e.substr(7),o=n.split(" ");return{msid:n,mslabel:o[0],label:o[1]}}},{}],3:[function(e,n,o){n.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],4:[function(e,n,o){var f=e("./senders"),d=e("./parsers"),i=Math.random();o._setIdCounter=function(e){i=e},o.toSessionJSON=function(e,n){var f,i=n.creators||[],t=n.role||"initiator",u=n.direction||"outgoing",l=e.split(/\r?\nm=/);for(f=1;f<l.length;f++)l[f]="m="+l[f],f!==l.length-1&&(l[f]+="\r\n");var p=l.shift()+"\r\n",J=d.lines(p),c={},s=[];for(f=0;f<l.length;f++)s.push(o.toMediaJSON(l[f],p,{role:t,direction:u,creator:i[f]||"initiator"}));c.contents=s;var y=d.findLines("a=group:",J);return y.length&&(c.groups=d.groups(y)),c},o.toMediaJSON=function(e,n,i){var t=i.creator||"initiator",u=i.role||"initiator",l=i.direction||"outgoing",p=d.lines(e),J=d.lines(n),c=d.mline(p[0]),s={creator:t,name:c.media,application:{applicationType:"rtp",media:c.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==c.media&&(s.application={applicationType:"datachannel"},s.transport.sctp=[]);var y=s.application,w=s.transport,a=d.findLine("a=mid:",p);if(a&&(s.name=a.substr(6)),d.findLine("a=sendrecv",p,J)?s.senders="both":d.findLine("a=sendonly",p,J)?s.senders=f[u][l].sendonly:d.findLine("a=recvonly",p,J)?s.senders=f[u][l].recvonly:d.findLine("a=inactive",p,J)&&(s.senders="none"),"rtp"==y.applicationType){var b=d.findLine("b=",p);b&&(y.bandwidth=d.bandwidth(b));var r=d.findLine("a=ssrc:",p);r&&(y.ssrc=r.substr(7).split(" ")[0]);var S=d.findLines("a=rtpmap:",p);S.forEach(function(e){var n=d.rtpmap(e);n.parameters=[],n.feedback=[];var o=d.findLines("a=fmtp:"+n.id,p);o.forEach(function(e){n.parameters=d.fmtp(e)});var f=d.findLines("a=rtcp-fb:"+n.id,p);f.forEach(function(e){n.feedback.push(d.rtcpfb(e))}),y.payloads.push(n)});var g=d.findLines("a=crypto:",p,J);g.forEach(function(e){y.encryption.push(d.crypto(e))}),d.findLine("a=rtcp-mux",p)&&(y.mux=!0);var m=d.findLines("a=rtcp-fb:*",p);m.forEach(function(e){y.feedback.push(d.rtcpfb(e))});var x=d.findLines("a=extmap:",p);x.forEach(function(e){var n=d.extmap(e);n.senders=f[u][l][n.senders],y.headerExtensions.push(n)});var j=d.findLines("a=ssrc-group:",p);y.sourceGroups=d.sourceGroups(j||[]);var h=d.findLines("a=ssrc:",p),k=y.sources=d.sources(h||[]),q=d.findLine("a=msid:",p);if(q){var v=d.msid(q);["msid","mslabel","label"].forEach(function(e){for(var n=0;n<k.length;n++){for(var o=!1,f=0;f<k[n].parameters.length;f++)k[n].parameters[f].key===e&&(o=!0);o||k[n].parameters.push({key:e,value:v[e]})}})}d.findLine("a=x-google-flag:conference",p,J)&&(y.googConferenceFlag=!0)}var z=d.findLines("a=fingerprint:",p,J),A=d.findLine("a=setup:",p,J);z.forEach(function(e){var n=d.fingerprint(e);A&&(n.setup=A.substr(8)),w.fingerprints.push(n)});var B=d.findLine("a=ice-ufrag:",p,J),C=d.findLine("a=ice-pwd:",p,J);if(B&&C){w.ufrag=B.substr(12),w.pwd=C.substr(10),w.candidates=[];var D=d.findLines("a=candidate:",p,J);D.forEach(function(e){w.candidates.push(o.toCandidateJSON(e))})}if("datachannel"==y.applicationType){var E=d.findLines("a=sctpmap:",p);E.forEach(function(e){var n=d.sctpmap(e);w.sctp.push(n)})}return s},o.toCandidateJSON=function(e){var n=d.candidate(e.split(/\r?\n/)[0]);return n.id=(i++).toString(36).substr(0,12),n}},{"./parsers":2,"./senders":3}],5:[function(e,n,o){var f=e("./senders");o.toSessionSDP=function(e,n){var f=(n.role||"initiator",n.direction||"outgoing",n.sid||e.sid||Date.now()),d=n.time||Date.now(),i=["v=0","o=- "+f+" "+d+" IN IP4 0.0.0.0","s=-","t=0 0"],t=e.contents||[],u=!1;t.forEach(function(e){e.application.sources&&e.application.sources.length&&(u=!0)}),u&&i.push("a=msid-semantic: WMS *");var l=e.groups||[];return l.forEach(function(e){i.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),t.forEach(function(e){i.push(o.toMediaSDP(e,n))}),i.join("\r\n")+"\r\n"},o.toMediaSDP=function(e,n){var d=[],i=n.role||"initiator",t=n.direction||"outgoing",u=e.application,l=e.transport,p=u.payloads||[],J=l&&l.fingerprints||[],c=[];if("datachannel"==u.applicationType?(c.push("application"),c.push("1"),c.push("DTLS/SCTP"),l.sctp&&l.sctp.forEach(function(e){c.push(e.number)})):(c.push(u.media),c.push("1"),J.length>0?c.push("UDP/TLS/RTP/SAVPF"):u.encryption&&u.encryption.length>0?c.push("RTP/SAVPF"):c.push("RTP/AVPF"),p.forEach(function(e){c.push(e.id)})),d.push("m="+c.join(" ")),d.push("c=IN IP4 0.0.0.0"),u.bandwidth&&u.bandwidth.type&&u.bandwidth.bandwidth&&d.push("b="+u.bandwidth.type+":"+u.bandwidth.bandwidth),"rtp"==u.applicationType&&d.push("a=rtcp:1 IN IP4 0.0.0.0"),l){l.ufrag&&d.push("a=ice-ufrag:"+l.ufrag),l.pwd&&d.push("a=ice-pwd:"+l.pwd);var s=!1;J.forEach(function(e){d.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&!s&&d.push("a=setup:"+e.setup)}),l.sctp&&l.sctp.forEach(function(e){d.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}"rtp"==u.applicationType&&d.push("a="+(f[i][t][e.senders]||"sendrecv")),d.push("a=mid:"+e.name),u.sources&&u.sources.length&&(u.sources[0].parameters||[]).forEach(function(e){"msid"===e.key&&d.push("a=msid:"+e.value)}),u.mux&&d.push("a=rtcp-mux");var y=u.encryption||[];y.forEach(function(e){d.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),u.googConferenceFlag&&d.push("a=x-google-flag:conference"),p.forEach(function(e){var n="a=rtpmap:"+e.id+" "+e.name+"/"+e.clockrate;if(e.channels&&"1"!=e.channels&&(n+="/"+e.channels),d.push(n),e.parameters&&e.parameters.length){var o=["a=fmtp:"+e.id],f=[];e.parameters.forEach(function(e){f.push((e.key?e.key+"=":"")+e.value)}),o.push(f.join(";")),d.push(o.join(" "))}e.feedback&&e.feedback.forEach(function(n){"trr-int"===n.type?d.push("a=rtcp-fb:"+e.id+" trr-int "+(n.value?n.value:"0")):d.push("a=rtcp-fb:"+e.id+" "+n.type+(n.subtype?" "+n.subtype:""))})}),u.feedback&&u.feedback.forEach(function(e){"trr-int"===e.type?d.push("a=rtcp-fb:* trr-int "+(e.value?e.value:"0")):d.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))});var w=u.headerExtensions||[];w.forEach(function(e){d.push("a=extmap:"+e.id+(e.senders?"/"+f[i][t][e.senders]:"")+" "+e.uri)});var a=u.sourceGroups||[];a.forEach(function(e){d.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))});var b=u.sources||[];b.forEach(function(e){for(var n=0;n<e.parameters.length;n++){var o=e.parameters[n];d.push("a=ssrc:"+(e.ssrc||u.ssrc)+" "+o.key+(o.value?":"+o.value:""))}});var r=l.candidates||[];return r.forEach(function(e){d.push(o.toCandidateSDP(e))}),d.join("\r\n")},o.toCandidateSDP=function(e){var n=[];n.push(e.foundation),n.push(e.component),n.push(e.protocol.toUpperCase()),n.push(e.priority),n.push(e.ip),n.push(e.port);var o=e.type;return n.push("typ"),n.push(o),("srflx"===o||"prflx"===o||"relay"===o)&&e.relAddr&&e.relPort&&(n.push("raddr"),n.push(e.relAddr),n.push("rport"),n.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(n.push("tcptype"),n.push(e.tcpType)),n.push("generation"),n.push(e.generation||"0"),"a=candidate:"+n.join(" ")}},{"./senders":3}]},{},[1])(1)});